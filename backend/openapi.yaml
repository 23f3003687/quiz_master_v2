openapi: 3.0.3
info:
  title: Quiz Master V2 API
  version: 1.0.0
  description: OpenAPI specification for the Quiz Master - V2 project.

servers:
  - url: http://localhost:5000

paths:
  /auth/login:
    post:
      summary: Login user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        '200':
          description: Login successful

  /auth/register:
    post:
      summary: Register user
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
                full_name:
                  type: string
                dob:
                  type: string
                  format: date
                qualification:
                  type: string
      responses:
        '201':
          description: User registered successfully

  /auth/profile:
    get:
      summary: Get current user profile
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile returned

  /user/dashboard:
    get:
      summary: User dashboard
      tags: [User]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Dashboard data

  /user/subjects:
    get:
      summary: Get all subjects for user
      tags: [User]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Subjects list

  /user/subject/{subject_id}/quizzes:
    get:
      summary: Get quizzes under a subject
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: subject_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of quizzes

  /user/quiz/{quiz_id}/attempt:
    get:
      summary: Get quiz for attempt
      tags: [User]
      parameters:
        - name: quiz_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Quiz attempt details

  /user/submit-quiz/{quiz_id}:
    post:
      summary: Submit a quiz
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: quiz_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                answers:
                  type: array
                  items:
                    type: object
                    properties:
                      question_id:
                        type: integer
                      selected_option:
                        type: string
      responses:
        '200':
          description: Quiz submitted successfully

  /user/score/{score_id}:
    get:
      summary: Get quiz scorecard
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: score_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Scorecard data

  /user/score/history:
    get:
      summary: Get user's quiz history
      tags: [User]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: History list

  /user/summary-report:
    get:
      summary: Get user's summary report
      tags: [User]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Summary data

  /user/search:
    get:
      summary: Search for subjects or quizzes
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Search results

  /user/export-quiz-history:
    post:
      summary: Trigger export of user's quiz history
      tags: [User]
      security:
        - bearerAuth: []
      responses:
        '202':
          description: Export task started

  /user/export-status/{task_id}:
    get:
      summary: Check export task status
      tags: [User]
      security:
        - bearerAuth: []
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Task status

  /admin/trigger-daily-reminders:
    get:
      summary: Trigger daily reminders
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Reminder triggered

  /admin/summary-report:
    get:
      summary: Admin dashboard summary report
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Admin summary

  /admin/search/admin:
    get:
      summary: Admin search for users/subjects/quizzes
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Search results

  /admin/users:
    get:
      summary: Get all users
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User list

  /admin/subjects:
    get:
      summary: Get all subjects
      tags: [Admin]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Subject list
    post:
      summary: Create a subject
      tags: [Admin]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        '201':
          description: Subject created

  /admin/subject/{subject_id}:
    get:
      summary: Get subject details
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: subject_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Subject detail
    put:
      summary: Update a subject
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: subject_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: Subject updated
    delete:
      summary: Delete a subject
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: subject_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Subject deleted

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

/admin/chapters:
    post:
      summary: Create a chapter
      tags: [Admin]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                subject_id:
                  type: integer
                name:
                  type: string
                description:
                  type: string
                difficulty_level:
                  type: string
      responses:
        '201':
          description: Chapter created

  /admin/chapters/{chapter_id}:
    put:
      summary: Update a chapter
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: chapter_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                difficulty_level:
                  type: string
      responses:
        '200':
          description: Chapter updated

    delete:
      summary: Delete a chapter
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: chapter_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Chapter deleted

  /admin/chapters/{chapter_id}/quizzes:
    get:
      summary: Get quizzes by chapter
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: chapter_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of quizzes

    post:
      summary: Create quiz for chapter
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: chapter_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                start_datetime:
                  type: string
                  format: date-time
                time_duration:
                  type: integer
                remarks:
                  type: string
                tags:
                  type: string
      responses:
        '201':
          description: Quiz created

  /admin/quizzes/{quiz_id}:
    put:
      summary: Update a quiz
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: quiz_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                start_datetime:
                  type: string
                  format: date-time
                time_duration:
                  type: integer
                remarks:
                  type: string
                tags:
                  type: string
      responses:
        '200':
          description: Quiz updated

    delete:
      summary: Delete a quiz
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: quiz_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Quiz deleted

  /admin/quizzes/{quiz_id}/questions:
    post:
      summary: Add a question to a quiz
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: quiz_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                question_statement:
                  type: string
                option1:
                  type: string
                option2:
                  type: string
                option3:
                  type: string
                option4:
                  type: string
                correct_option:
                  type: string
                difficulty:
                  type: string
                explanation:
                  type: string
                marks:
                  type: integer
      responses:
        '201':
          description: Question created

    get:
      summary: Get questions of a quiz
      tags: [Admin]
      parameters:
        - name: quiz_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of questions

  /admin/questions/{question_id}:
    put:
      summary: Update a question
      tags: [Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: question_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                question_statement:
                  type: string
                option1:
                  type: string
                option2:
                  type: string
                option3:
                  type: string
                option4:
                  type: string
                correct_option:
                  type: string
                difficulty:
                  type: string
                explanation:
                  type: string
                marks:
                  type: integer
      responses:
        '200':
          description: Question updated

    delete:
      summary: Delete a question
      tags: [Admin]
      parameters:
        - name: question_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Question deleted

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
